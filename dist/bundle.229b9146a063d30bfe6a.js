(()=>{"use strict";var t={682:(t,e,r)=>{const i=function(t){return document.querySelector(t)};function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}const a=function(){function t(e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=i,this.lyricMap=this.parseLyric(e),this.lyricsWrapper=Array.from(i.children).filter((function(t){return t.className.includes("js-lyrics-wrapper")}))[0],this.lyricsList=Array.from(this.lyricsWrapper.children).filter((function(t){return t.className.includes("js-lyrics-list")}))[0],this.titleNode=Array.from(i.children).filter((function(t){return t.className.includes("js-lyrics-title")}))[0],this.allSentences=null,this.intervalId=void 0,this.currentTime=0,this.isCounting=!1,this.currentPlaying="",this.activeClassName="is--current",this.offset=45,this.lyricsList.style.top="0px",this.reset(),this.setTitle(r),this.render()}var e,r;return e=t,(r=[{key:"parseLyric",value:function(t){for(var e=t.split(""),r=0,i=e.length,n=void 0,a={},s=!0;r<=i;){if("["===e[r-1]?(s=!0,n=""):"]"===e[r]&&(s=!1,a[n=Math.floor(this.convertToMilliSec(n))]=""),!0===s&&(n+="".concat(e[r])),!1===s&&"["!==e[r]&&"]"!==e[r]&&e[r]){var c="".concat(e[r]);a[n]+=c}r++}return a}},{key:"convertToMilliSec",value:function(t){return 100*parseInt(t.split(":")[0],10)*60+100*parseFloat(t.split(":")[1])}},{key:"render",value:function(){var t=this,e="";for(var r in t.lyricMap)e+=t.createLyricTmpl(t.lyricMap[r],r);t.lyricsList.innerHTML=e,t.allSentences=Array.from(t.lyricsList.querySelectorAll("p"))}},{key:"createLyricTmpl",value:function(t,e){return'<p data-time="'.concat(e,'">').concat(t,"</p>")}},{key:"start",value:function(t){var e=this;e.isCounting=!0,t>0&&(e.clear(),e.updateCurrent(e.getNearest(100*t.toFixed(2)))),e.currentTime=100*t.toFixed(2),e.intervalId=window.setInterval((function(){for(var t in e.currentTime++,e.lyricMap)Math.ceil(t)===e.currentTime&&(e.clear(),e.updateCurrent(e.currentTime))}),10)}},{key:"getNearest",value:function(t){var e=[];for(var r in this.lyricMap)e.push(r);e.push(t);var i=e.sort((function(t,e){return t-e}));return i[i.indexOf(t)-1]}},{key:"stop",value:function(){this.isCounting=!1,window.clearInterval(this.intervalId)}},{key:"updateCurrent",value:function(t){var e=this,r=e.allSentences.find((function(e){return parseInt(e.dataset.time)===parseInt(t)}));if(r){r.classList.add(e.activeClassName);var i=e.allSentences.findIndex((function(e){return parseInt(e.dataset.time)===parseInt(t)})),n=r.getBoundingClientRect().top,a=window.innerHeight;if(e.lyricsList.style.top="-".concat(e.offset*i,"px"),n>a/3){if(i>e.allSentences.length-3)return;var s=isNaN(parseInt(e.lyricsList.style.top.replace("px","").trim(),10))?0:parseInt(e.lyricsList.style.top.replace("px","").trim(),10);e.lyricsList.style.top="".concat(s-e.offset,"px")}}}},{key:"clear",value:function(){var t=this,e=t.allSentences.find((function(e){return e.classList.contains(t.activeClassName)}));e&&e.classList.remove(t.activeClassName)}},{key:"removeAll",value:function(){this.lyricsList.innerHTML=""}},{key:"reset",value:function(){this.titleNode.innerText="",this.lyricsList.innerHTML=""}},{key:"setTitle",value:function(t){this.titleNode.innerText=t}}])&&n(e.prototype,r),t}();function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}const c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isPlaying=!1,this.playlist=e,this.currentPlaylist=e,this.currentTrack=null,this.audioEl=new Audio,this.progressTimer=null,this.playBtn=i(".js-start-btn"),this.prevBtn=i(".js-prev-btn"),this.nextBtn=i(".js-next-btn"),this.loopBtn=i(".js-loop-btn"),this.repeatBtn=i(".js-repeat-btn"),this.randomBtn=i(".js-random-btn"),this.progressBar=i(".js-progress-bar"),this.playerBg=i(".js-player-bg"),this.cover=i(".js-cover"),this.trackTitle=i(".js-song-title"),this.artistName=i(".js-artist-name"),this.listPage=i(".js-track-list"),this.randomList=this.shuffleArray(this.playlist),this.repeatOneList=[this.currentTrack],this.loopList=this.playlist,this.playMode="loop",this.prompter=null}var e,r;return e=t,(r=[{key:"setTrack",value:function(t){this.currentTrack=this.getTrack(t),this.audioEl.src=this.currentTrack.path,this.audioEl.currentTime=0,this.updateProgressBar(),this.stopTrack(),this.setCoverArt(this.currentTrack),this.setTrackInfo(this.currentTrack),this.setCurrentItem(t),this.prompter=new a(this.currentTrack.lyrics,this.currentTrack.name,i(".js-lyrics-container"))}},{key:"playTrack",value:function(){var t=this;t.isPlaying=!0,t.audioEl.play(),Array.from(t.playBtn.childNodes).filter((function(t){return"IMG"===t.tagName}))[0].src="./assets/icon/ic_pause.png",t.updateProgressBar(),t.prompter&&t.prompter.start(t.audioEl.currentTime)}},{key:"playNext",value:function(){var t=this;t.setTrack(function(){for(var e=0;e<t.currentPlaylist.length;e++)if(t.currentPlaylist[e].id===t.currentTrack.id)return void 0!==t.currentPlaylist[e+1]?t.currentPlaylist[e+1].id:t.currentPlaylist[0].id}()),t.playTrack()}},{key:"playPrev",value:function(){var t=this;t.setTrack(function(){for(var e=0;e<t.currentPlaylist.length;e++)if(t.currentPlaylist[e].id===t.currentTrack.id)return void 0!==t.currentPlaylist[e-1]?t.currentPlaylist[e-1].id:t.currentPlaylist[t.currentPlaylist.length-1].id}()),t.playTrack()}},{key:"setTrackCurrentTime",value:function(t){var e=this;e.stopTrack(),e.audioEl.currentTime=t,e.playTrack()}},{key:"updateProgressBar",value:function(){var t=this,e=Array.from(t.progressBar.childNodes).filter((function(t){return void 0!==t.classList&&t.classList.contains("js-bar")}))[0];t.progressTimer=setInterval((function(){e.setAttribute("style","width:".concat(t.calculateProgressBar(t.audioEl.currentTime,t.audioEl.duration),"%"))}),500)}},{key:"calculateProgressBar",value:function(t,e){return t/e*100}},{key:"stopProgressBar",value:function(){window.clearInterval(this.progressTimer)}},{key:"stopTrack",value:function(){var t=this;t.isPlaying=!1,Array.from(t.playBtn.childNodes).filter((function(t){return"IMG"===t.tagName}))[0].src="./assets/icon/ic_play.png",t.audioEl.pause(),t.stopProgressBar(),t.prompter&&t.prompter.stop()}},{key:"getTrackCurrentTime",value:function(){return this.audioEl.currentTime}},{key:"getTrackDuration",value:function(){return this.audioEl.duration}},{key:"getTrack",value:function(t){return this.playlist.find((function(e){return parseInt(e.id)===parseInt(t)}))}},{key:"setCoverArt",value:function(t){this.cover.src=t.art,this.playerBg.setAttribute("src",t.art)}},{key:"setTrackInfo",value:function(t){this.trackTitle.innerText=t.name,this.artistName.innerText=t.artist}},{key:"createList",value:function(){var t=this,e="";this.playlist.forEach((function(r){e+=t.createListItem(r)})),this.listPage.innerHTML=e}},{key:"createListItem",value:function(t){return'<li class="list__item" data-id="'.concat(t.id,'">\n          <div class="item__content">\n            <h3>').concat(t.name,"</h3>\n            <p>").concat(t.artist,"</p>\n          </div>\n        </li>")}},{key:"setCurrentItem",value:function(t){var e=Array.from(document.querySelectorAll(".list__item"));e.forEach((function(t){t.classList.remove("is--current")})),e.find((function(e){return parseInt(e.dataset.id)===parseInt(t)})).classList.add("is--current")}},{key:"setPlayMode",value:function(t){var e=this;switch(t){case"loop":e.currentPlaylist=e.playlist;break;case"random":e.currentPlaylist=e.shuffleArray(e.playlist);break;case"repeatOne":e.currentPlaylist=[e.currentTrack]}}},{key:"shuffleArray",value:function(t){for(var e,r=t.length;r;){r--,e=Math.floor(Math.random()*r);var i=t[r];t[r]=t[e],t[e]=i}return t}},{key:"initialize",value:function(){var t=this;t.createList(),t.setPlayMode("loop"),t.setTrack(t.currentPlaylist[0].id),t.audioEl.currentTime=0,t.updateProgressBar(),t.playBtn.addEventListener("click",(function(e){t.isPlaying?t.stopTrack():t.playTrack()})),t.menuToggle=i(".js-menu-btn"),t.container=i(".js-container"),t.container.addEventListener("click",(function(t){var e="current--".concat(t.target.dataset.to),r=i(".js-container");void 0!==t.target.dataset.to&&(["player","lyric","list"].forEach((function(t){r.classList.remove("current--".concat(t))})),r.classList.add(e))})),t.listPage.addEventListener("click",(function(e){var r=e.target.closest(".list__item");t.setTrack(r.dataset.id)})),t.progressBar.addEventListener("mousedown",(function(e){var r=t.progressBar.offsetWidth,i=e.offsetX/r*t.audioEl.duration;t.setTrackCurrentTime(i),t.updateProgressBar()}));var e=Array.from(document.querySelectorAll(".js-mode-btn"));e.forEach((function(r){r.addEventListener("click",(function(i){e.forEach((function(t){t.classList.remove("is--current")})),r.classList.add("is--current"),t.setPlayMode(this.dataset.playmode)}))})),t.nextBtn.addEventListener("click",(function(e){t.playNext()})),t.prevBtn.addEventListener("click",(function(e){t.playPrev()})),t.audioEl.addEventListener("ended",(function(){t.prompter.removeAll(),t.playNext()}))}}])&&s(e.prototype,r),t}();r(433);document.querySelectorAll(".js-action").forEach((function(t){t.addEventListener("click",(function(t){(function(t,e){return Array.from(t.children).filter((function(t){return t.className.includes(e)}))[0]}(this,"js-action-img")).src="./assets/icon/".concat(this.getAttribute("data-actionImg"),".png")}))})),fetch("./assets/songs.json").then((function(t){return t.json()})).then((function(t){new c(t).initialize()}))},433:(t,e,r)=>{r.r(e),r.d(e,{default:()=>i});const i=r.p+"/css/style.css"}},e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={exports:{}};return t[i](n,n.exports,r),n.exports}r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="",r(682),r(433)})();